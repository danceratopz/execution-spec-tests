
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://execution-spec-tests.readthedocs.io/getting_started/writing_tests/">
      
      
        <link rel="prev" href="../package_overview/">
      
      
        <link rel="next" href="../reference_specification/">
      
      <link rel="icon" href="../../img/ETH-logo-icon.svg">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.14">
    
    
      
        <title>Writing Tests - Ethereum Execution Spec Tests</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Writing Tests - Ethereum Execution Spec Tests" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://execution-spec-tests.readthedocs.io/assets/images/social/getting_started/writing_tests.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://execution-spec-tests.readthedocs.io/getting_started/writing_tests/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Writing Tests - Ethereum Execution Spec Tests" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://execution-spec-tests.readthedocs.io/assets/images/social/getting_started/writing_tests.png" >
      
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#writing-tests" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Ethereum Execution Spec Tests" class="md-header__button md-logo" aria-label="Ethereum Execution Spec Tests" data-md-component="logo">
      
  <img src="../../img/ETH-logo-icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ethereum Execution Spec Tests
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Writing Tests
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Ethereum Execution Spec Tests" class="md-nav__button md-logo" aria-label="Ethereum Execution Spec Tests" data-md-component="logo">
      
  <img src="../../img/ETH-logo-icon.svg" alt="logo">

    </a>
    Ethereum Execution Spec Tests
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Test Case Descriptions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Test Case Descriptions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../test_case_descriptions/eip4844/" class="md-nav__link">
        EIP-4844
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quick_start/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../package_overview/" class="md-nav__link">
        Package Overview
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Writing Tests
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Writing Tests
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose-of-test-specs-in-this-repository" class="md-nav__link">
    Purpose of test specs in this repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types-of-tests" class="md-nav__link">
    Types of tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-new-test" class="md-nav__link">
    Adding a New Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-spec-generator-functions" class="md-nav__link">
    Test Spec Generator Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statetest-object" class="md-nav__link">
    StateTest Object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blockchaintest-object" class="md-nav__link">
    BlockchainTest Object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepost-state-of-the-test" class="md-nav__link">
    Pre/Post State of the Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-transactions" class="md-nav__link">
    Test Transactions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-code-for-the-accounts-in-the-test" class="md-nav__link">
    Writing code for the accounts in the test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verifying-the-accounts-post-state" class="md-nav__link">
    Verifying the Accounts' Post State
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-account-object" class="md-nav__link">
    The Account object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verifying-correctness-of-the-new-test" class="md-nav__link">
    Verifying correctness of the new test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failing-or-invalid-transactions" class="md-nav__link">
    Failing or invalid transactions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference_specification/" class="md-nav__link">
        Adding a Reference Spec
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/state_transition/" class="md-nav__link">
        State Transition Tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/blockchain/" class="md-nav__link">
        Blockchain Tests
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Test (Filler) Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Test (Filler) Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fillers/withdrawals/" class="md-nav__link">
        Withdrawals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Library Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Library Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../library/library/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../library/ethereum_test_forks/" class="md-nav__link">
        Ethereum Test Forks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../library/ethereum_test_tools/" class="md-nav__link">
        Ethereum Test Tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../library/evm_block_builder/" class="md-nav__link">
        EVM Block Builder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../library/evm_transition_tool/" class="md-nav__link">
        EVM Transition Tool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../library/pytest_plugins/" class="md-nav__link">
        Pytest Plugins
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose-of-test-specs-in-this-repository" class="md-nav__link">
    Purpose of test specs in this repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types-of-tests" class="md-nav__link">
    Types of tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-new-test" class="md-nav__link">
    Adding a New Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-spec-generator-functions" class="md-nav__link">
    Test Spec Generator Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statetest-object" class="md-nav__link">
    StateTest Object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blockchaintest-object" class="md-nav__link">
    BlockchainTest Object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepost-state-of-the-test" class="md-nav__link">
    Pre/Post State of the Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-transactions" class="md-nav__link">
    Test Transactions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-code-for-the-accounts-in-the-test" class="md-nav__link">
    Writing code for the accounts in the test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verifying-the-accounts-post-state" class="md-nav__link">
    Verifying the Accounts' Post State
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-account-object" class="md-nav__link">
    The Account object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verifying-correctness-of-the-new-test" class="md-nav__link">
    Verifying correctness of the new test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failing-or-invalid-transactions" class="md-nav__link">
    Failing or invalid transactions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="writing-tests">Writing Tests<a class="headerlink" href="#writing-tests" title="Permanent link">#</a></h1>
<h2 id="purpose-of-test-specs-in-this-repository">Purpose of test specs in this repository<a class="headerlink" href="#purpose-of-test-specs-in-this-repository" title="Permanent link">#</a></h2>
<p>The goal of the test specs included in this repository is to generate test vectors that can be consumed by any Execution client, and to verify that all of the clients agree on the same output after executing each test.</p>
<p>Consensus is the most important aspect of any blockchain network, therefore, anything that modifies the state of the blockchain must be tested by at least one test in this repository.</p>
<p>The tests focus on the EVM execution, therefore before being able to properly write a test, it is important to understand what the Ethereum Virtual Machine is and how it works.</p>
<h2 id="types-of-tests">Types of tests<a class="headerlink" href="#types-of-tests" title="Permanent link">#</a></h2>
<p>At the moment there are only two types of tests that can be produced by each test spec:</p>
<ul>
<li>State Tests</li>
<li>Blockchain Tests</li>
</ul>
<p>The State tests span a single block and, ideally, a single transaction.</p>
<p>Examples of State tests:</p>
<ul>
<li>Test a single opcode behavior</li>
<li>Verify opcode gas costs</li>
<li>Test interactions between multiple smart contracts</li>
<li>Test creation of smart contracts</li>
</ul>
<p>The Blockchain tests span multiple blocks which may or may not contain transactions and mainly focus on the block to block effects to the Ethereum state.</p>
<ul>
<li>Verify system-level operations such as coinbase balance updates or withdrawals</li>
<li>Verify fork transitions</li>
<li>Verify blocks with invalid transactions/properties are rejected</li>
</ul>
<h2 id="adding-a-new-test">Adding a New Test<a class="headerlink" href="#adding-a-new-test" title="Permanent link">#</a></h2>
<p>All currently implemented tests can be found in the <code>fillers</code>
directory, which is composed of many subdirectories, and each one represents a
different test category.</p>
<p>Source files included in each category contain one or multiple test specs
represented as python functions, and each can in turn produce one or many test
vectors.</p>
<p>A new test can be added by either:</p>
<ul>
<li>Adding a new <code>test_</code> python function to an existing file in any of the
  existing category subdirectories within <code>fillers</code>.</li>
<li>Creating a new source file in an existing category, and populating it with
  the new test function(s).</li>
<li>Creating an entirely new category by adding a subdirectory in
  <code>fillers</code> with the appropriate source files and test functions.<ul>
<li>Tests within multiple sub-directories must have a <code>__init__.py</code> file
  within each directory above it (and it own), to ensure the test is found by the test filler <code>tf</code>.</li>
</ul>
</li>
</ul>
<h2 id="test-spec-generator-functions">Test Spec Generator Functions<a class="headerlink" href="#test-spec-generator-functions" title="Permanent link">#</a></h2>
<p>Every test spec is a python generator function which can perform a single or
multiple <code>yield</code> operations during its runtime to each time yield a single
<code>StateTest</code>/<code>BlockchainTest</code> object.</p>
<p>The test vector's generator function <em>must</em> be decorated by only one of the
following decorators:
- <code>test_from</code>
- <code>test_from_until</code>
- <code>test_only</code></p>
<p>These decorators specify the forks on which the test vector is supposed to run.</p>
<p>They also automatically append necessary information for the
<code>ethereum_test_filling_tool</code> to process when the generator is being executed to
fill the tests.</p>
<p>The test vector function must take only one <code>str</code> parameter: the fork name.</p>
<h2 id="statetest-object"><code>StateTest</code> Object<a class="headerlink" href="#statetest-object" title="Permanent link">#</a></h2>
<p>The <code>StateTest</code> object represents a single test vector, and contains the
following attributes:</p>
<ul>
<li>env: Environment object which describes the global state of the blockchain
    before the test starts.</li>
<li>pre: Pre-State containing the information of all Ethereum accounts that exist
    before any transaction is executed.</li>
<li>post: Post-State containing the information of all Ethereum accounts that are
    created or modified after all transactions are executed.</li>
<li>txs: All transactions to be executed during the test vector runtime.</li>
</ul>
<h2 id="blockchaintest-object"><code>BlockchainTest</code> Object<a class="headerlink" href="#blockchaintest-object" title="Permanent link">#</a></h2>
<p>The <code>BlockchainTest</code> object represents a single test vector that evaluates the
Ethereum VM by attempting to append multiple blocks to the chain:</p>
<ul>
<li>pre: Pre-State containing the information of all Ethereum accounts that exist
    before any block is executed.</li>
<li>post: Post-State containing the information of all Ethereum accounts that are
    created or modified after all blocks are executed.</li>
<li>blocks: All blocks to be appended to the blockchain during the test.</li>
</ul>
<h2 id="prepost-state-of-the-test">Pre/Post State of the Test<a class="headerlink" href="#prepost-state-of-the-test" title="Permanent link">#</a></h2>
<p>The <code>pre</code> and <code>post</code> states are elemental to setup and then verify the outcome
of the state test.</p>
<p>Both <code>pre</code> and <code>post</code> are mappings of account addresses to <code>account</code> structures (see <a href="#the-account-object">more info</a>).</p>
<p>A single test vector can contain as many accounts in the <code>pre</code> and <code>post</code> states
as required, and they can be also filled dynamically.</p>
<p><code>storage</code> of an account is a key/value dictionary, and its values are
integers within range of <code>[0, 2**256 - 1]</code>.</p>
<p><code>txs</code> are the steps which transform the pre-state into the post-state and
must perform specific actions within the accounts (smart contracts) that result
in verifiable changes to the balance, nonce, and/or storage in each of them.</p>
<p><code>post</code> is compared against the outcome of the client after the execution
of each transaction, and any differences are considered a failure</p>
<p>When designing a test, all the changes must be ideally saved into the contract's
storage to be able to verify them in the post-state.</p>
<h2 id="test-transactions">Test Transactions<a class="headerlink" href="#test-transactions" title="Permanent link">#</a></h2>
<p>Transactions can be crafted by sending them with specific <code>data</code> or to a
specific account, which contains the code to be executed</p>
<p>Transactions can also create more accounts, by setting the <code>to</code> field to an 
empty string.</p>
<p>Transactions can be designed to fail, and a verification must be made that the
transaction fails with the specific error that matches what is expected by the
test.</p>
<h2 id="writing-code-for-the-accounts-in-the-test">Writing code for the accounts in the test<a class="headerlink" href="#writing-code-for-the-accounts-in-the-test" title="Permanent link">#</a></h2>
<p>Account bytecode can be embedded in the test accounts by adding it to the <code>code</code>
field of the <code>account</code> object, or the <code>data</code> field of the <code>tx</code> object if the
bytecode is meant to be treated as init code or call data.</p>
<p>The code can be in either of the following formats:
- <code>bytes</code> object, representing the raw opcodes in binary format
- <code>str</code>, representing an hexadecimal format of the opcodes
- <code>Code</code> compilable object</p>
<p>Currently supported built-in compilable objects are:</p>
<ul>
<li><code>Yul</code> object containing <a href="https://docs.soliditylang.org/en/latest/yul.html">Yul source code</a></li>
</ul>
<p><code>Code</code> objects can be concatenated together by using the <code>+</code> operator.</p>
<h2 id="verifying-the-accounts-post-state">Verifying the Accounts' Post State<a class="headerlink" href="#verifying-the-accounts-post-state" title="Permanent link">#</a></h2>
<p>The state of the accounts after all blocks/transactions have been executed is
the way of verifying that the execution client actually behaves like the test
expects.</p>
<p>During their filling process, all tests automatically verify that the accounts
specified in their <code>post</code> property actually match what was returned by the
transition tool.</p>
<p>Within the <code>post</code> dictionary object, an account address can be:
- <code>None</code>: The account will not be checked for absence or existence in the
  result returned by the transition tool.
- <code>Account</code> object: The test expects that this account exist and also has
  properties equal to the properties specified by the <code>Account</code> object.
- <code>Account.NONEXISTENT</code>: The test expects that this account does not exist in
  the result returned by the transition tool, and if the account exists,
  it results in error.
  E.g. when the transaction creating a contract is expected to fail and the
  test wants to verify that the address where the contract was supposed to be
  created is indeed empty.</p>
<h2 id="the-account-object">The <code>Account</code> object<a class="headerlink" href="#the-account-object" title="Permanent link">#</a></h2>
<p>The <code>Account</code> object is used to specify the properties of an account to be
verified in the post state.</p>
<p>The python representation can be found in <a href="https://github.com/ethereum/execution-spec-tests/blob/main/src/ethereum_test_tools/common/types.py">src/ethereum_test_tools/common/types.py</a>.</p>
<p>It can verify the following properties of an account:
- <code>nonce</code>: the scalar value equal to a) the number of transactions sent by
  an Externally Owned Account, b) the amount of contracts created by a contract.</p>
<ul>
<li>
<p><code>balance</code>: the amount of Wei (10<sup>-18</sup> Eth) the account has.</p>
</li>
<li>
<p><code>code</code>: Bytecode contained by the account. To verify that an account contains
  no code, this property needs to be set to "0x" or "".</p>
</li>
</ul>
<p>It is not recommended to verify Yul compiled code in the output account,
  because the bytecode can change from version to version.</p>
<ul>
<li><code>storage</code>: Storage within the account represented as a <code>dict</code> object.
  All storage keys that are expected to be set must be specified, and if a
  key is skipped, it is implied that its expected value is zero.
  Setting this property to <code>{}</code> (empty <code>dict</code>), means that all the keys in the
  account must be unset (equal to zero).</li>
</ul>
<p>All account's properties are optional, and they can be skipped or set to <code>None</code>,
which means that no check will be performed on that specific account property.</p>
<h2 id="verifying-correctness-of-the-new-test">Verifying correctness of the new test<a class="headerlink" href="#verifying-correctness-of-the-new-test" title="Permanent link">#</a></h2>
<p>A well written test performs a single verification output at a time.</p>
<p>A verification output can be a single storage slot, the balance of an account,
or a newly created contract.</p>
<p>It is not recommended to use balance changes to verify test correctness, as it
can be easily affected by gas cost changes in future EIPs.</p>
<p>The best way to verify a transaction/block execution outcome is to check its
storage.</p>
<p>A test can be written as a negative verification. E.g. a contract is not
created, or a transaction fails to execute or runs out of gas.</p>
<p>These verifications must be carefully crafted because it is possible to end up
having a false positive result, which means that the test passed but the
intended verification was never made.</p>
<p>To avoid these scenarios, it is important to have a separate verification to
check that test is effective. E.g. when a transaction is supposed to fail, it
is necessary to check that the failure error is actually the one expected by
the test.</p>
<h2 id="failing-or-invalid-transactions">Failing or invalid transactions<a class="headerlink" href="#failing-or-invalid-transactions" title="Permanent link">#</a></h2>
<p>Transactions included in a StateTest are expected to be intrinsically valid,
i.e. the account sending the transaction must have enough funds to cover the
gas costs, the max fee of the transaction must be equal or higher than the
base fee of the block, etc.</p>
<p>An intrinsically valid transaction can still revert during its execution.</p>
<p>Blocks in a BlockchainTest can contain intrinsically invalid transactions but
in this case the block is expected to be completely rejected, along with all
transactions in it, including other valid transactions.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright: 2023, Ethereum Community
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>